import{j as e,B as j,T as R,r as s,ae as be,t as J,I as T,P as je,M as De,m as ae,n as G,ag as Ce,ah as U,D as X,s as ye,l as K,ai as ve,aM as H,aN as le,aO as oe,aP as Se,aQ as we,aR as ke,h as Pe,a0 as Te,H as Ee}from"./index-C2iXY8ra.js";import{C as Le}from"./config-global-78atMH3e.js";import{T as V,a as w,b as Q,C as Re,K as Ae,P as Ie,R as Me,c as Oe,d as ze,u as We,e as Fe,f as Ne,g as $e,h as Be,D as He,i as qe,j as Ge,k as Ke}from"./index-BRSSBFDZ.js";import{a as z}from"./apiClient-CqGJZrRH.js";import{u as Ue}from"./notificationSnackbar-D5H_8dBm.js";import{C as ie,L as Qe}from"./Checkbox-CW6AAsyi.js";import{f as Ve,v as _e,a as Je,e as Xe,g as Ye}from"./utils-y1iOOS8T.js";import{O as Ze,M as et,T as q}from"./TextField-DwwPb3TO.js";import{I as tt}from"./InputAdornment-B7fUEd-A.js";import{a as rt,S as nt}from"./Stack-Blh1MSla.js";import{C as st}from"./Card-bXk435uA.js";import{G as W}from"./Grid-C4VPN10G.js";import"./LastPage-DNl6HMzJ.js";import"./useFormControl-CM1PNU5y.js";import"./Popper-BPhzGuzW.js";function at({searchQuery:t,...a}){return e.jsx(V,{...a,children:e.jsx(w,{align:"center",colSpan:7,children:e.jsxs(j,{sx:{py:15,textAlign:"center"},children:[e.jsx(R,{variant:"h6",sx:{mb:1},children:"Not found"}),e.jsxs(R,{variant:"body2",children:["No results found for  ",e.jsxs("strong",{children:['"',t,'"']}),".",e.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}function lt({row:t,selected:a,onSelectRow:o,onEdit:c,onDelete:n,isDeleting:d}){const[m,D]=s.useState(null),[k,y]=s.useState(!1),p=be(),P=Array.isArray(t)?t[0]:t,x=s.useCallback(A=>{D(A.currentTarget)},[]),u=s.useCallback(()=>{D(null)},[]),b=s.useCallback(()=>{u(),p(`/detaildepartement/${t.idDepartement}`)},[p,t.idDepartement,u]),E=s.useCallback(()=>{u(),c(t)},[t,c,u]),g=s.useCallback(()=>{u(),y(!0)},[u]),C=s.useCallback(()=>{n(t.idDepartement),y(!1),u()},[n,t.idDepartement,u]);return Ve(P),e.jsxs(e.Fragment,{children:[e.jsxs(V,{hover:!0,tabIndex:-1,role:"checkbox",selected:a,children:[e.jsx(w,{padding:"checkbox",children:e.jsx(ie,{disableRipple:!0,checked:a,onChange:o})}),e.jsx(w,{children:e.jsx(Q,{title:t.libelleLongDepartement||"",arrow:!0,children:e.jsx(j,{sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.libelleLongDepartement||""})})}),e.jsx(w,{children:e.jsx(Qe,{color:"primary",variant:"filled",children:t.libelleCourtDepartement||""})}),e.jsx(w,{children:e.jsx(Q,{title:t.sloganDepartement||"",arrow:!0,children:e.jsx(j,{sx:{maxWidth:150,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.sloganDepartement||""})})}),e.jsx(w,{children:t.responsableDepartement||""}),e.jsx(w,{align:"center",children:e.jsx(J,{onClick:x,children:e.jsx(T,{icon:"eva:more-vertical-fill"})})})]}),e.jsx(je,{open:!!m,anchorEl:m,onClose:u,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsxs(De,{disablePadding:!0,sx:{p:.5,gap:.5,width:140,display:"flex",flexDirection:"column",[`& .${ae.root}`]:{px:1,gap:2,borderRadius:.75,[`&.${ae.selected}`]:{bgcolor:"action.selected"}}},children:[e.jsxs(G,{onClick:b,children:[e.jsx(T,{icon:"solar:eye-bold"}),"Détail"]}),e.jsxs(G,{onClick:E,children:[e.jsx(T,{icon:"solar:pen-bold"}),"Modifier"]}),e.jsxs(G,{onClick:g,sx:{color:"error.main"},disabled:d,children:[e.jsx(T,{icon:"solar:trash-bin-trash-bold"}),d?"Suppression...":"Supprimer"]})]})}),e.jsx(Re,{open:k,title:"Suppression du département",message:`Voulez-vous vraiment supprimer le département "${t.libelleLongDepartement}" (${t.libelleCourtDepartement}) ?`,confirmText:"Supprimer",cancelText:"Annuler",loading:d,onConfirm:C,onClose:()=>y(!1)})]})}function ot({emptyRows:t,height:a,sx:o,...c}){return t?e.jsx(V,{sx:{...a&&{height:a*t},...o},...c,children:e.jsx(w,{colSpan:9})}):null}function it({numSelected:t,filterName:a,onFilterName:o,onDelete:c,deleteLoading:n=!1}){return e.jsxs(Ce,{sx:{height:96,display:"flex",justifyContent:"space-between",p:d=>d.spacing(0,1,0,3),...t>0&&{color:"primary.main",bgcolor:"primary.lighter"}},children:[t>0?e.jsxs(R,{component:"div",variant:"subtitle1",children:[t," département(s) sélectionné(s)"]}):e.jsx(Ze,{fullWidth:!0,value:a,onChange:o,placeholder:"Rechercher un département...",startAdornment:e.jsx(tt,{position:"start",children:e.jsx(T,{width:20,icon:"eva:search-fill",sx:{color:"text.disabled"}})}),sx:{maxWidth:320}}),t>0?e.jsx(Q,{title:"Supprimer les départements sélectionnés",children:e.jsx(J,{onClick:c,disabled:n,children:e.jsx(T,{icon:"solar:trash-bin-trash-bold"})})}):e.jsx(Q,{title:"Options de filtrage",children:e.jsx(J,{children:e.jsx(T,{icon:"ic:round-filter-list"})})})]})}const ct=t=>(U(a=>a.authentification),e.jsxs(j,{sx:{width:"100%"},children:[e.jsx(j,{sx:{display:"flex",width:"100%"},children:e.jsxs(j,{sx:{display:"flex",justifyContent:"center",width:"100%"},children:[e.jsx(j,{sx:{fontSize:12,fontWeight:"bold",width:"50%",fontFamily:"arial",border:"1px solid hidden"},children:e.jsx(j,{children:e.jsx(R,{variant:"body2",sx:{fontSize:17,textTransform:"uppercase"}})})}),e.jsx(j,{sx:{fontSize:12,width:"50%",border:"1px solid hidden",fontFamily:"arial",alignContent:"flex-end",alignItems:"flex-end"},children:e.jsxs(j,{sx:{display:"flex",width:"100%",alignItems:"flex-end",justifyContent:"flex-end",alignSelf:"flex-end"},children:[e.jsxs(R,{variant:"body2",sx:{fontSize:13,fontWeight:"bold",color:"black"},children:["Tél église"," "]}),e.jsx(R,{variant:"body2",sx:{fontSize:13,ml:.625,fontWeight:"bold",color:"black"}})]})})]})}),e.jsx(j,{sx:{mt:.625,display:"flex",width:"100%"},children:e.jsx(X,{sx:{backgroundColor:"black",width:"100%",height:1,mt:.0625}})})]})),dt=()=>{const t=U(o=>o.culte.listCulte),a=U(o=>o.authentification.utilisateurData);return[...t||[]].sort((o,c)=>{const n=new Date(o.dateCulte).getTime();return new Date(c.dateCulte).getTime()-n}),e.jsx(j,{sx:{width:"100%",maxWidth:1400,mx:"auto",p:3,backgroundColor:"#f9fafb",minHeight:"100vh"},children:e.jsx(ct,{paramEtab:a})})},pt=ye(t=>e.jsx(et,{elevation:0,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},...t}))(({theme:t})=>({"& .MuiPaper-root":{borderRadius:6,marginTop:t.spacing(1),minWidth:180,color:t.palette.mode==="light"?"rgb(55, 65, 81)":t.palette.grey[300],boxShadow:"rgb(255, 255, 255) 0px 0px 0px 0px, rgba(0, 0, 0, 0.05) 0px 0px 0px 1px, rgba(0, 0, 0, 0.1) 0px 10px 15px -3px, rgba(0, 0, 0, 0.05) 0px 4px 6px -2px","& .MuiMenu-list":{padding:"4px 0"},"& .MuiMenuItem-root":{"& .MuiSvgIcon-root":{fontSize:18,color:t.palette.text.secondary,marginRight:t.spacing(1.5)},"&:active":{backgroundColor:rt(t.palette.primary.main,t.palette.action.selectedOpacity)}}}})),ut=s.forwardRef((t,a)=>e.jsx("div",{ref:a,children:e.jsx(dt,{})})),mt=()=>{const t=s.useRef(null);s.useRef(null);const[a,o]=s.useState(null),c=!!a,n=m=>{o(m.currentTarget)},d=()=>{o(null)};return e.jsxs("div",{children:[e.jsx(K,{id:"demo-customized-button","aria-controls":c?"demo-customized-menu":void 0,"aria-haspopup":"true","aria-expanded":c?"true":void 0,variant:"contained",color:"inherit",onClick:n,endIcon:e.jsx(Ae,{}),children:"Imprimer"}),e.jsxs(pt,{id:"demo-customized-menu",MenuListProps:{"aria-labelledby":"demo-customized-button"},anchorEl:a,open:c,onClose:d,children:[e.jsxs(G,{onClick:d,sx:{height:32},children:[e.jsx(Ie,{}),e.jsx(Me,{trigger:()=>e.jsx("div",{children:"Liste des membres"}),content:()=>t.current}),e.jsx("div",{style:{display:"none"},children:e.jsx(ut,{ref:t})})]}),e.jsx(X,{sx:{my:.5}})]})]})};function ht({order:t,orderBy:a,rowCount:o,numSelected:c,onSort:n,onSelectAllRows:d,headLabel:m}){const[D,k]=s.useState(!1),y=p=>{const P=p.target.checked;k(P);const x=P?Array.from({length:o},(u,b)=>b.toString()):[];d(P,x)};return e.jsx(Oe,{children:e.jsxs(V,{children:[e.jsx(w,{padding:"checkbox",children:e.jsx(ie,{indeterminate:c>0&&c<o,checked:o>0&&c===o,onChange:y})}),m.map(p=>e.jsx(w,{align:p.align||"left",sortDirection:a===p.id?t:!1,sx:{width:p.width,minWidth:p.width},children:e.jsxs(ze,{hideSortIcon:!0,active:a===p.id,direction:a===p.id?t:"asc",onClick:()=>n(p.id),children:[p.label,a===p.id?e.jsx(j,{sx:{..._e},children:t==="desc"?"sorted descending":"sorted ascending"}):null]})},p.id))]})})}function xt(){var ee,te,re,ne;const t=ve(),a=U(r=>r.departement.listDepartement),[o,c]=s.useState(!0),n=gt(),{selected:d,onSelectAllRows:m}=n,[D,k]=s.useState(""),[y,p]=s.useState(!1),[P]=s.useState("lg"),[x,u]=s.useState({...H}),[b,E]=s.useState(!1),[g,C]=s.useState(!1),[A,F]=s.useState(!1),{showNotification:h,NotificationComponent:ce}=Ue(),{setFocus:_,register:N,handleSubmit:de,formState:{errors:$}}=We(),I=s.useCallback(()=>{p(!1),E(!1),u({...H})},[]),pe=s.useCallback(()=>p(!0),[]),M=s.useCallback(async()=>{try{c(!0);const r=await z.getDepartements();r.status===1&&t(le(r.data))}catch(r){console.error("Error fetching departements:",r)}finally{c(!1)}},[t]),ue=s.useCallback(async r=>{var i;try{C(!0);const l=await z.deleteDepartement(r);l.status===1?(t(oe(r)),h("Département supprimé avec succès","success")):h(`Erreur: ${((i=l.error)==null?void 0:i.message)||"Erreur inconnue"}`,"error")}catch(l){console.error("Error deleting département:",l),h(`Erreur: ${l.message||"Erreur lors de la suppression"}`,"error")}finally{C(!1)}},[t,h]),me=s.useCallback(r=>{E(!0),console.log("Données pour édition:",r),u(r),p(!0)},[]),Y=s.useCallback(async r=>{try{F(!0);const l={...a.find(S=>S.idDepartement===x.idDepartement),...r,idDepartement:x.idDepartement},f={...l};console.log("Données envoyées à l'API:",l),(await z.updateDepartement(f)).status===1?(t(Se(f)),I(),M(),h("Département modifié avec succès","success")):h("Erreur lors de la modification du département","error")}catch(i){console.error("Error updating département:",i),h("Erreur lors de la modification","error")}finally{F(!1)}},[x.idDepartement,a,t,I,h,M]),Z=s.useCallback(async r=>{if(b)await Y(r);else try{F(!0);const i={...r,idUtilisateur:null},l=await z.createDepartement(i);l.status===1?(t(we(l.data)),t(le(l.data)),t(ke(l.data)),M(),I(),h("Département créé avec succès","success")):h("Erreur lors de la création du département","error")}catch(i){console.error("Error creating département:",i),h("Erreur lors de la création du département","error")}finally{F(!1)}},[b,Y,t,M,I,h]),he=s.useCallback(r=>{if(!r.libelleLongDepartement){h("Le libellé long est requis","warning");return}if(!r.libelleCourtDepartement){h("Le libellé court est requis","warning");return}const i={...r,...b&&x.idDepartement&&{idDepartement:x.idDepartement}};Z(i)},[b,x.idDepartement,Z,h]);s.useEffect(()=>{M()},[M]);const O=s.useMemo(()=>{const r=Array.isArray(a)?a:[];return Je({inputData:r,comparator:Ye(n==null?void 0:n.order,n==null?void 0:n.orderBy),filterName:D})},[a,n.order,n.orderBy,D]),xe=!(O!=null&&O.length)&&!!D,v=s.useMemo(()=>O.sort((r,i)=>{var L,S;const l=(L=r.libelleLongDepartement)==null?void 0:L.toLowerCase(),f=(S=i.libelleLongDepartement)==null?void 0:S.toLowerCase();return n.order==="asc"?l==null?void 0:l.localeCompare(f):f==null?void 0:f.localeCompare(l)}),[O,n.order]),B=s.useCallback(r=>{const{name:i,value:l}=r.target;u(f=>({...f,[i]:l}))},[]),ge=s.useCallback(async()=>{if(d.length!==0)try{C(!0);const r=d==null?void 0:d.map(L=>{const S=parseInt(L,10);return z.deleteDepartement(S).then(()=>(t(oe(S)),{success:!0,id:S})).catch(se=>(console.error(`Erreur suppression département ${S}:`,se),{success:!1,id:S,error:se}))}),i=await Promise.all(r),l=i.filter(L=>L.success).length,f=i.length-l;m(!1,[]),f===0?h(`${l} département(s) supprimé(s) avec succès`,"success"):h(`${l} supprimé(s), ${f} erreur(s)`,f===d.length?"error":"warning")}catch(r){console.error("Erreur générale lors de la suppression multiple:",r),h(`Erreur: ${r.message||"Erreur lors de la suppression"}`,"error")}finally{C(!1)}},[d,m,t,h]);s.useEffect(()=>{y||setTimeout(()=>{u({...H}),E(!1)},100)},[y]),s.useEffect(()=>{b||u({...H})},[b]);const fe=b?"Modifier un département":"Ajouter un département";return e.jsxs(Pe,{children:[e.jsxs(j,{display:"flex",alignItems:"center",mb:5,children:[e.jsx(R,{variant:"h4",flexGrow:1,children:"Liste des départements"}),e.jsxs(nt,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(mt,{}),e.jsx(K,{variant:"contained",color:"inherit",startIcon:e.jsx(T,{icon:"mingcute:add-line"}),onClick:pe,disabled:o,children:o?"Chargement...":"Ajouter département"})]})]}),e.jsxs(st,{children:[e.jsx(it,{numSelected:d.length,filterName:D,onFilterName:r=>{k(r.target.value),n.onResetPage()},onDelete:ge,deleteLoading:g}),e.jsx(Te,{children:e.jsx(Fe,{sx:{overflow:"unset"},children:e.jsxs(Ne,{sx:{minWidth:800},children:[e.jsx(ht,{order:n.order,orderBy:n.orderBy,rowCount:v==null?void 0:v.length,numSelected:(ee=n.selected)==null?void 0:ee.length,onSort:n==null?void 0:n.onSort,onSelectAllRows:r=>n==null?void 0:n.onSelectAllRows(r,v==null?void 0:v.map(i=>{var l;return((l=i.idDepartement)==null?void 0:l.toString())||""})),headLabel:[{id:"libelleLongDepartement",label:"Departement"},{id:"libelleCourtDepartement",label:"Sigle"},{id:"sloganDepartement",label:"Slogan"},{id:"responsableDepartement",label:"Responsable"},{id:"Action",label:"Actions"}]}),e.jsxs($e,{children:[(te=v==null?void 0:v.slice(n.page*n.rowsPerPage,n.page*n.rowsPerPage+n.rowsPerPage))==null?void 0:te.map(r=>{var i,l;return e.jsx(lt,{row:r,selected:(l=n.selected)==null?void 0:l.includes(((i=r.idDepartement)==null?void 0:i.toString())||""),onSelectRow:()=>{var f;return n==null?void 0:n.onSelectRow(((f=r.idDepartement)==null?void 0:f.toString())||"")},onEdit:me,onDelete:ue,isDeleting:g},r.idDepartement)}),e.jsx(ot,{height:68,emptyRows:Xe(n.page,n.rowsPerPage,v.length)}),xe&&e.jsx(at,{searchQuery:D})]})]})})}),e.jsx(Be,{component:"div",page:n.page,count:v.length,rowsPerPage:n.rowsPerPage,onPageChange:n.onChangePage,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:n.onChangeRowsPerPage})]}),e.jsxs(He,{maxWidth:P,open:y,onClose:I,"aria-labelledby":"responsive-dialog-title",children:[e.jsx(qe,{children:fe}),e.jsx(Ge,{children:e.jsxs("form",{onSubmit:de(he),children:[e.jsxs(W,{container:!0,spacing:2,children:[e.jsx(W,{item:!0,xs:12,sm:6,children:e.jsx(q,{fullWidth:!0,size:"small",margin:"dense",label:"Département *",variant:"outlined",value:x.libelleLongDepartement,...N("libelleLongDepartement",{required:"Le departement est requis"}),onChange:B,error:!!$.libelleLongDepartement,helperText:(re=$.libelleLongDepartement)==null?void 0:re.message,onKeyDown:r=>{r.key==="Enter"&&(r.preventDefault(),_("libelleCourtDepartement"))}})}),e.jsx(W,{item:!0,xs:12,sm:6,children:e.jsx(q,{fullWidth:!0,size:"small",margin:"dense",label:"Sigle *",variant:"outlined",value:x.libelleCourtDepartement,...N("libelleCourtDepartement",{required:"Le sigle est requis"}),onChange:B,error:!!$.libelleCourtDepartement,helperText:(ne=$.libelleCourtDepartement)==null?void 0:ne.message,onKeyDown:r=>{r.key==="Enter"&&(r.preventDefault(),_("sloganDepartement"))}})}),e.jsx(W,{item:!0,xs:12,sm:6,children:e.jsx(q,{fullWidth:!0,size:"small",margin:"dense",label:"Slogan",variant:"outlined",value:x.sloganDepartement,...N("sloganDepartement"),onChange:B,onKeyDown:r=>{r.key==="Enter"&&(r.preventDefault(),_("responsableDepartement"))}})}),e.jsx(W,{item:!0,xs:12,sm:6,children:e.jsx(q,{fullWidth:!0,size:"small",margin:"dense",label:"Responsable",variant:"outlined",value:x.responsableDepartement,...N("responsableDepartement"),onChange:B})})]}),e.jsx(X,{sx:{my:2}}),e.jsxs(Ke,{children:[e.jsx(K,{onClick:I,color:"primary",children:"Annuler"}),e.jsx(K,{type:"submit",color:"primary",variant:"contained",disabled:A,children:A?"Enregistrement...":b?"Modifier":"Enregistrer"})]})]})})]}),e.jsx(ce,{})]})}function gt(){const[t,a]=s.useState(0),[o,c]=s.useState("name"),[n,d]=s.useState(5),[m,D]=s.useState([]),[k,y]=s.useState("asc"),p=s.useCallback(g=>{y(o===g&&k==="asc"?"desc":"asc"),c(g)},[k,o]),P=s.useCallback((g,C)=>{if(g){D(C);return}D([])},[]),x=s.useCallback(g=>{const C=m!=null&&m.includes(g)?m==null?void 0:m.filter(A=>A!==g):[...m,g];D(C)},[m]),u=s.useCallback(()=>{a(0)},[]),b=s.useCallback((g,C)=>{a(C)},[]),E=s.useCallback(g=>{d(parseInt(g.target.value,10)),u()},[u]);return{page:t,order:k,onSort:p,orderBy:o,selected:m,rowsPerPage:n,onSelectRow:x,onResetPage:u,onChangePage:b,onSelectAllRows:P,onChangeRowsPerPage:E}}function At(){return e.jsxs(e.Fragment,{children:[e.jsx(Ee,{children:e.jsxs("title",{children:[" ",`Departement - ${Le.appName}`]})}),e.jsx(xt,{})]})}export{At as default};
