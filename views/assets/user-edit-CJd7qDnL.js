import{ap as le,ae as ne,ai as se,r as c,ah as me,j as e,h as N,ad as W,B as j,T as o,l as b,A as ue,aL as de,t as O,I as oe,aC as ce,n as s,aE as be,aD as he,D as h,aF as xe,as as pe,ar as $,aH as Me,av as ve,aI as je,aJ as ge,aK as fe,az as Ce}from"./index-C2iXY8ra.js";import{B as Ee,a as Se}from"./apiClient-CqGJZrRH.js";import{u as Ne}from"./notificationSnackbar-D5H_8dBm.js";import{S as _}from"./Stack-Blh1MSla.js";import{S as H,A as J}from"./Skeleton-D2-GEIGL.js";import{C as K,S as Q}from"./Save-vqwcxNV7.js";import{C as We}from"./Card-bXk435uA.js";import{G as i}from"./Grid-C4VPN10G.js";import{E as ye}from"./Edit-qknhX8SQ.js";import{T as n}from"./TextField-DwwPb3TO.js";import"./useFormControl-CM1PNU5y.js";function Ve(){var R,L,w,A,P,F,G,T,U,V,q,z;const{id:x}=le(),p=ne(),X=se(),{showNotification:d}=Ne(),[Y,De]=c.useState(!1),[g,y]=c.useState(!1),[M,Z]=c.useState(null),[r,f]=c.useState({}),[v,C]=c.useState(null),[Be,D]=c.useState(null),E=me(a=>a.membre);c.useEffect(()=>{if(x&&E.length>0){const a=parseInt(x,10),t=E.find(m=>m.idMembre===a);if(t){Z(t);const m={nomMembre:t.nomMembre||"",prenomMembre:t.prenomMembre||"",dateNaissMembre:t.dateNaissMembre||"",lieuNaissMembre:t.lieuNaissMembre||"",sexeMembre:t.sexeMembre||"",emailMembre:t.emailMembre||"",nationaliteMembre:t.nationaliteMembre||"",fonctionMembre:t.fonctionMembre||"",contactMembre:t.contactMembre||"",ethnieMembre:t.ethnieMembre||"",residenceMembre:t.residenceMembre||"",civiliteMembre:t.civiliteMembre||"",nouvelleAmeMembre:t.nouvelleAmeMembre||"",dateConversionMembre:t.dateConversionMembre||"",baptemeEauMembre:t.baptemeEauMembre||"",dateBaptemeMembre:t.dateBaptemeMembre||"",dateMariageMembre:t.dateMariageMembre||"",capaciteSpirituelleMembre:t.capaciteSpirituelleMembre||"",situationMatrimonialeMembre:t.situationMatrimonialeMembre||"",nomFiance:t.nomFiance||"",lieuBaptemeEauMembre:t.lieuBaptemeEauMembre||"",baptemeSaintEspritMembre:t.baptemeSaintEspritMembre||"",dateBaptemeSaintEspritMembre:t.dateBaptemeSaintEspritMembre||"",egliseOrigineMembre:t.egliseOrigineMembre||"",nomAmiEglise:t.nomAmiEglise||"",visiteMembre:t.visiteMembre||"",raisonNonVisiteMembre:t.raisonNonVisiteMembre||"",heureVisiteMembre:t.heureVisiteMembre||"",dateDecisionMembre:t.dateDecisionMembre||"",lieuTravailMembre:t.lieuTravailMembre||"",idNiveauEtude:t.idNiveauEtude||"",idCellule:t.idCellule||"",idDepartement:t.idDepartement||"",idGroupe:t.idGroupe||"",idResponsabilite:t.idResponsabilite||"",photoMembre:t.photoMembre||""};if(f(m),t.photoMembre){const u=ee(t.photoMembre);C(u)}}else d("Membre non trouvé","error"),p("/membres")}},[x,E,p,d]);const ee=a=>!a||a===""?null:a.startsWith("data:image/")||a.startsWith("http")?a:`${Ee}/photos/${a}`,l=a=>{const{name:t,value:m}=a.target;f(u=>({...u,[t]:m}))},ae=async a=>{var m;const t=(m=a.target.files)==null?void 0:m[0];if(t){if(t.size>5*1024*1024){d("La photo ne doit pas dépasser 5MB","warning");return}if(!t.type.startsWith("image/")){d("Veuillez sélectionner une image valide","warning");return}D(t);const u=URL.createObjectURL(t);C(u);const S=await re(t);f(ie=>({...ie,photoMembre:S}))}},re=a=>new Promise((t,m)=>{const u=new FileReader;u.readAsDataURL(a),u.onload=()=>t(u.result),u.onerror=S=>m(S)}),te=()=>{D(null),C(null),f(a=>({...a,photoMembre:""})),v&&URL.revokeObjectURL(v)},B=async()=>{if(M){if(!r.nomMembre.trim()){d("Le nom est requis","warning");return}if(!r.contactMembre.trim()){d("Le contact est requis","warning");return}try{y(!0);const a={...r,idMembre:M.idMembre,idNiveauEtude:r.idNiveauEtude?Number(r.idNiveauEtude):null,idCellule:r.idCellule?Number(r.idCellule):null,idDepartement:r.idDepartement?Number(r.idDepartement):null,idGroupe:r.idGroupe?Number(r.idGroupe):null,idResponsabilite:r.idResponsabilite?Number(r.idResponsabilite):null,sexeMembre:Number(r.sexeMembre)||null,nouvelleAmeMembre:Number(r.nouvelleAmeMembre)||null,baptemeEauMembre:Number(r.baptemeEauMembre)||null,baptemeSaintEspritMembre:Number(r.baptemeSaintEspritMembre)||null,situationMatrimonialeMembre:Number(r.situationMatrimonialeMembre)||null,visiteMembre:Number(r.visiteMembre)||null,capaciteSpirituelleMembre:Number(r.capaciteSpirituelleMembre)||null};console.log("Données à envoyer:",a);const t=await Se.updateMembre(a);t.status===1?(X(Ce(t.data)),d("Membre modifié avec succès","success"),p(`/details/${x}`)):d("Erreur lors de la modification du membre","error")}catch(a){console.error("Error updating membre:",a),d("Erreur lors de la modification","error")}finally{y(!1)}}},k=()=>{p(`/details/${x}`)},I=()=>{p("/membres")};return Y?e.jsx(N,{children:e.jsx(W,{maxWidth:"lg",children:e.jsxs(_,{spacing:3,children:[e.jsx(H,{variant:"rectangular",height:56}),e.jsx(H,{variant:"rectangular",height:400})]})})}):M?e.jsx(N,{children:e.jsxs(W,{maxWidth:"lg",children:[e.jsxs(j,{mb:3,display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(b,{startIcon:e.jsx(J,{}),onClick:I,children:"Retour à la liste"}),e.jsxs(j,{children:[e.jsx(b,{variant:"outlined",startIcon:e.jsx(K,{}),onClick:k,sx:{mr:2},children:"Annuler"}),e.jsx(b,{variant:"contained",startIcon:e.jsx(Q,{}),onClick:B,disabled:g,children:g?"Enregistrement...":"Enregistrer"})]})]}),e.jsx(o,{variant:"h4",gutterBottom:!0,children:"Modifier le membre"}),e.jsxs(o,{variant:"body1",color:"text.secondary",paragraph:!0,children:["Modifiez les informations de ",M.nomMembre," ",M.prenomMembre]}),e.jsx(We,{sx:{p:3,mb:3},children:e.jsxs(i,{container:!0,spacing:3,children:[e.jsx(i,{item:!0,xs:12,children:e.jsxs(_,{alignItems:"center",spacing:2,children:[e.jsxs(j,{position:"relative",children:[e.jsx(ue,{src:v||void 0,sx:{width:120,height:120,border:"2px solid #ccc",backgroundColor:"#f5f5f5"},children:!v&&e.jsx(de,{fontSize:"large"})}),e.jsxs(O,{component:"label",sx:{position:"absolute",bottom:0,right:0,backgroundColor:"primary.main",color:"white","&:hover":{backgroundColor:"primary.dark"}},children:[e.jsx(ye,{}),e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:ae})]}),v&&e.jsx(O,{onClick:te,sx:{position:"absolute",top:0,right:0,backgroundColor:"error.main",color:"white","&:hover":{backgroundColor:"error.dark"}},children:e.jsx(oe,{icon:"mdi:close"})})]}),e.jsx(o,{variant:"caption",color:"text.secondary",children:"Cliquez sur l'icône pour modifier la photo"})]})}),e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsx(n,{fullWidth:!0,label:"Nom *",name:"nomMembre",value:r.nomMembre||"",onChange:l,required:!0})}),e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsx(n,{fullWidth:!0,label:"Prénoms",name:"prenomMembre",value:r.prenomMembre||"",onChange:l})}),e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsx(n,{fullWidth:!0,select:!0,label:"Civilité",name:"civiliteMembre",value:r.civiliteMembre||"",onChange:l,children:(R=ce)==null?void 0:R.map(a=>e.jsx(s,{value:a.value,children:a.label},a.value))})}),e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsx(n,{fullWidth:!0,select:!0,label:"Genre",name:"sexeMembre",value:r.sexeMembre||"",onChange:l,children:(L=be)==null?void 0:L.map(a=>e.jsx(s,{value:a.value,children:a.label},a.value))})}),e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsx(n,{fullWidth:!0,type:"date",label:"Date de naissance",name:"dateNaissMembre",value:r.dateNaissMembre||"",onChange:l,InputLabelProps:{shrink:!0}})}),e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsx(n,{fullWidth:!0,label:"Lieu de naissance",name:"lieuNaissMembre",value:r.lieuNaissMembre||"",onChange:l})}),e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsx(n,{fullWidth:!0,label:"Nationalité",name:"nationaliteMembre",value:r.nationaliteMembre||"",onChange:l})}),e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsx(n,{fullWidth:!0,label:"Ethnie",name:"ethnieMembre",value:r.ethnieMembre||"",onChange:l})}),e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(n,{fullWidth:!0,select:!0,label:"Niveau d'étude",name:"idNiveauEtude",value:r.idNiveauEtude||"",onChange:l,children:[e.jsx(s,{value:"",children:e.jsx("em",{children:"Sélectionner"})}),(w=he)==null?void 0:w.map(a=>e.jsx(s,{value:a.value,children:a.label},a.value))]})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(h,{sx:{my:2},children:e.jsx(o,{variant:"h6",children:"Contact"})})}),e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsx(n,{fullWidth:!0,label:"Téléphone *",name:"contactMembre",value:r.contactMembre||"",onChange:l,required:!0})}),e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsx(n,{fullWidth:!0,label:"Email",name:"emailMembre",type:"email",value:r.emailMembre||"",onChange:l})}),e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsx(n,{fullWidth:!0,label:"Résidence",name:"residenceMembre",value:r.residenceMembre||"",onChange:l})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(h,{sx:{my:2},children:e.jsx(o,{variant:"h6",children:"Vie professionnelle"})})}),e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsx(n,{fullWidth:!0,label:"Fonction",name:"fonctionMembre",value:r.fonctionMembre||"",onChange:l})}),e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsx(n,{fullWidth:!0,label:"Lieu de travail",name:"lieuTravailMembre",value:r.lieuTravailMembre||"",onChange:l})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(h,{sx:{my:2},children:e.jsx(o,{variant:"h6",children:"Situation familiale"})})}),e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsx(n,{fullWidth:!0,select:!0,label:"Situation matrimoniale",name:"situationMatrimonialeMembre",value:r.situationMatrimonialeMembre||"",onChange:l,children:(A=xe)==null?void 0:A.map(a=>e.jsx(s,{value:a.value,children:a.label},a.value))})}),r.situationMatrimonialeMembre==="3"&&e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsx(n,{fullWidth:!0,label:"Nom fiancé(e)",name:"nomFiance",value:r.nomFiance||"",onChange:l})}),r.situationMatrimonialeMembre==="5"&&e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsx(n,{fullWidth:!0,type:"date",label:"Date de mariage",name:"dateMariageMembre",value:r.dateMariageMembre||"",onChange:l,InputLabelProps:{shrink:!0}})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(h,{sx:{my:2},children:e.jsx(o,{variant:"h6",children:"Vie spirituelle"})})}),e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsx(n,{fullWidth:!0,label:"Église d'origine",name:"egliseOrigineMembre",value:r.egliseOrigineMembre||"",onChange:l})}),e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsx(n,{fullWidth:!0,type:"date",label:"Date de conversion",name:"dateConversionMembre",value:r.dateConversionMembre||"",onChange:l,InputLabelProps:{shrink:!0}})}),e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsx(n,{fullWidth:!0,select:!0,label:"Nouvelle âme",name:"nouvelleAmeMembre",value:r.nouvelleAmeMembre||"",onChange:l,children:(P=pe)==null?void 0:P.map(a=>e.jsx(s,{value:a.value,children:a.label},a.value))})}),e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsx(n,{fullWidth:!0,select:!0,label:"Baptême d'eau",name:"baptemeEauMembre",value:r.baptemeEauMembre||"",onChange:l,children:(F=$)==null?void 0:F.map(a=>e.jsx(s,{value:a.value,children:a.label},a.value))})}),r.baptemeEauMembre==="1"&&e.jsxs(e.Fragment,{children:[e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsx(n,{fullWidth:!0,type:"date",label:"Date du baptême d'eau",name:"dateBaptemeMembre",value:r.dateBaptemeMembre||"",onChange:l,InputLabelProps:{shrink:!0}})}),e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsx(n,{fullWidth:!0,label:"Lieu du baptême",name:"lieuBaptemeEauMembre",value:r.lieuBaptemeEauMembre||"",onChange:l})})]}),e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsx(n,{fullWidth:!0,select:!0,label:"Baptême du Saint-Esprit",name:"baptemeSaintEspritMembre",value:r.baptemeSaintEspritMembre||"",onChange:l,children:(G=$)==null?void 0:G.map(a=>e.jsx(s,{value:a.value,children:a.label},a.value))})}),r.baptemeSaintEspritMembre==="1"&&e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsx(n,{fullWidth:!0,type:"date",label:"Date du baptême Saint-Esprit",name:"dateBaptemeSaintEspritMembre",value:r.dateBaptemeSaintEspritMembre||"",onChange:l,InputLabelProps:{shrink:!0}})}),e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsx(n,{fullWidth:!0,select:!0,label:"Capacité spirituelle",name:"capaciteSpirituelleMembre",value:r.capaciteSpirituelleMembre||"",onChange:l,children:(T=Me)==null?void 0:T.map(a=>e.jsx(s,{value:a.value,children:a.label},a.value))})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(h,{sx:{my:2},children:e.jsx(o,{variant:"h6",children:"Engagement dans l'église"})})}),e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(n,{fullWidth:!0,select:!0,label:"Responsabilité",name:"idResponsabilite",value:r.idResponsabilite||"",onChange:l,children:[e.jsx(s,{value:"",children:e.jsx("em",{children:"Sélectionner"})}),(U=ve)==null?void 0:U.map(a=>e.jsx(s,{value:a.value,children:a.label},a.value))]})}),e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(n,{fullWidth:!0,select:!0,label:"Département/Comité",name:"idDepartement",value:r.idDepartement||"",onChange:l,children:[e.jsx(s,{value:"",children:e.jsx("em",{children:"Sélectionner"})}),(V=je)==null?void 0:V.map(a=>e.jsx(s,{value:a.value,children:a.label},a.value))]})}),e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(n,{fullWidth:!0,select:!0,label:"Cellule",name:"idCellule",value:r.idCellule||"",onChange:l,children:[e.jsx(s,{value:"",children:e.jsx("em",{children:"Sélectionner"})}),(q=ge)==null?void 0:q.map(a=>e.jsx(s,{value:a.value,children:a.label},a.value))]})}),e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(n,{fullWidth:!0,select:!0,label:"Groupe ethnique",name:"idGroupe",value:r.idGroupe||"",onChange:l,children:[e.jsx(s,{value:"",children:e.jsx("em",{children:"Sélectionner"})}),(z=fe)==null?void 0:z.map(a=>e.jsx(s,{value:a.value,children:a.label},a.value))]})}),e.jsxs(i,{item:!0,xs:12,children:[e.jsx(h,{sx:{my:2}}),e.jsxs(j,{display:"flex",justifyContent:"flex-end",gap:2,children:[e.jsx(b,{variant:"outlined",startIcon:e.jsx(K,{}),onClick:k,children:"Annuler"}),e.jsx(b,{variant:"contained",startIcon:e.jsx(Q,{}),onClick:B,disabled:g,children:g?"Enregistrement...":"Enregistrer les modifications"})]})]})]})})]})}):e.jsx(N,{children:e.jsx(W,{maxWidth:"lg",children:e.jsxs(j,{textAlign:"center",py:10,children:[e.jsx(o,{variant:"h5",color:"text.secondary",gutterBottom:!0,children:"Membre non trouvé"}),e.jsx(b,{variant:"contained",startIcon:e.jsx(J,{}),onClick:I,children:"Retour à la liste"})]})})})}export{Ve as UserEditView,Ve as default};
