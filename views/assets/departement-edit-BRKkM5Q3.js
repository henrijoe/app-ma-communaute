import{ap as P,ae as z,ai as F,r as u,ah as J,j as e,h as y,ad as L,B as c,T as l,l as d,ab as V,D as j,aP as $}from"./index-C2iXY8ra.js";import{a as G}from"./apiClient-CqGJZrRH.js";import{u as H}from"./notificationSnackbar-D5H_8dBm.js";import{i as K,d as Q}from"./utils-y1iOOS8T.js";import{S as X}from"./Stack-Blh1MSla.js";import{S as q,A as R}from"./Skeleton-D2-GEIGL.js";import{C as w,S as A}from"./Save-vqwcxNV7.js";import{C as W}from"./Card-bXk435uA.js";import{G as s}from"./Grid-C4VPN10G.js";import{T as x}from"./TextField-DwwPb3TO.js";import"./useFormControl-CM1PNU5y.js";function oe(){const{id:h}=P(),b=z(),B=F(),{showNotification:m}=H(),[T,N]=u.useState(!0),[p,I]=u.useState(!1),[a,U]=u.useState(null),[t,f]=u.useState({}),[o,v]=u.useState({}),g=J(r=>r.departement.listDepartement);u.useEffect(()=>{if(h&&g.length>0){const r=parseInt(h,10),n=g.find(i=>i.idDepartement===r);if(n){U(n);const i={libelleLongDepartement:n.libelleLongDepartement||"",libelleCourtDepartement:n.libelleCourtDepartement||"",sloganDepartement:n.sloganDepartement||"",responsableDepartement:n.responsableDepartement||"",idUtilisateur:n.idUtilisateur||null};f(i)}else m("Département non trouvé","error"),b("/departements");N(!1)}},[h,g,b,m]);const D=r=>{const{name:n,value:i}=r.target;f(C=>({...C,[n]:i})),o[n]&&v(C=>({...C,[n]:""}))},M=()=>{var n,i;const r={};return(n=t.libelleLongDepartement)!=null&&n.trim()?t.libelleLongDepartement.length>100?r.libelleLongDepartement="Le libellé long ne doit pas dépasser 100 caractères":K(g,t.libelleLongDepartement,a==null?void 0:a.idDepartement)||(r.libelleLongDepartement="Ce libellé long est déjà utilisé"):r.libelleLongDepartement="Le libellé long est requis",(i=t.libelleCourtDepartement)!=null&&i.trim()?t.libelleCourtDepartement.length>20?r.libelleCourtDepartement="Le libellé court ne doit pas dépasser 20 caractères":Q(g,t.libelleCourtDepartement,a==null?void 0:a.idDepartement)||(r.libelleCourtDepartement="Ce libellé court est déjà utilisé"):r.libelleCourtDepartement="Le libellé court est requis",t.sloganDepartement&&t.sloganDepartement.length>200&&(r.sloganDepartement="Le slogan ne doit pas dépasser 200 caractères"),t.responsableDepartement&&t.responsableDepartement.length>100&&(r.responsableDepartement="Le nom du responsable ne doit pas dépasser 100 caractères"),v(r),Object.keys(r).length===0},S=async()=>{var r;if(!(!a||!a.idDepartement)){if(!M()){m("Veuillez corriger les erreurs dans le formulaire","warning");return}try{I(!0);const n={...t,idDepartement:a.idDepartement};console.log("Données à envoyer:",n);const i=await G.updateDepartement(n);i.status===1?(B($(i.data)),m("Département modifié avec succès","success"),b(`/detaildepartement/${h}`)):m(((r=i.error)==null?void 0:r.message)||"Erreur lors de la modification du département","error")}catch(n){console.error("Error updating département:",n),m(`Erreur: ${n.message||"Erreur lors de la modification"}`,"error")}finally{I(!1)}}},E=()=>{b(`/detaildepartement/${h}`)},k=()=>{b("/departements")},O=()=>{if(a){const r={libelleLongDepartement:a.libelleLongDepartement||"",libelleCourtDepartement:a.libelleCourtDepartement||"",sloganDepartement:a.sloganDepartement||"",responsableDepartement:a.responsableDepartement||""};f(r),v({})}};return T?e.jsx(y,{children:e.jsx(L,{maxWidth:"lg",children:e.jsxs(X,{spacing:3,children:[e.jsx(q,{variant:"rectangular",height:56}),e.jsx(q,{variant:"rectangular",height:400})]})})}):a?e.jsx(y,{children:e.jsxs(L,{maxWidth:"lg",children:[e.jsxs(c,{mb:3,display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(d,{startIcon:e.jsx(R,{}),onClick:k,children:"Retour à la liste"}),e.jsxs(c,{children:[e.jsx(d,{variant:"outlined",startIcon:e.jsx(w,{}),onClick:E,sx:{mr:2},children:"Annuler"}),e.jsx(d,{variant:"contained",startIcon:e.jsx(A,{}),onClick:S,disabled:p,children:p?"Enregistrement...":"Enregistrer"})]})]}),e.jsx(l,{variant:"h4",gutterBottom:!0,children:"Modifier le département"}),e.jsxs(l,{variant:"body1",color:"text.secondary",paragraph:!0,children:['Modifiez les informations du département "',a.libelleLongDepartement,'"']}),Object.keys(o).length>0&&e.jsx(V,{severity:"warning",sx:{mb:3},children:"Veuillez corriger les erreurs ci-dessous avant de sauvegarder."}),e.jsx(W,{sx:{p:3,mb:3},children:e.jsxs(s,{container:!0,spacing:3,children:[e.jsx(s,{item:!0,xs:12,children:e.jsx(j,{sx:{mb:3},children:e.jsx(l,{variant:"h6",children:"Informations générales"})})}),e.jsx(s,{item:!0,xs:12,md:8,children:e.jsx(x,{fullWidth:!0,label:"Libellé long *",name:"libelleLongDepartement",value:t.libelleLongDepartement||"",onChange:D,required:!0,error:!!o.libelleLongDepartement,helperText:o.libelleLongDepartement||"Nom complet du département (max. 100 caractères)",placeholder:"Ex: Département de la Jeunesse et des Sports"})}),e.jsx(s,{item:!0,xs:12,md:4,children:e.jsx(x,{fullWidth:!0,label:"Libellé court *",name:"libelleCourtDepartement",value:t.libelleCourtDepartement||"",onChange:D,required:!0,error:!!o.libelleCourtDepartement,helperText:o.libelleCourtDepartement||"Abréviation (max. 20 caractères)",placeholder:"Ex: DJS"})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(x,{fullWidth:!0,label:"Slogan",name:"sloganDepartement",value:t.sloganDepartement||"",onChange:D,error:!!o.sloganDepartement,helperText:o.sloganDepartement||"Slogan ou devise du département (max. 200 caractères)",placeholder:"Ex: Servir avec excellence et intégrité",multiline:!0,rows:2})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(x,{fullWidth:!0,label:"Responsable",name:"responsableDepartement",value:t.responsableDepartement||"",onChange:D,error:!!o.responsableDepartement,helperText:o.responsableDepartement||"Nom du responsable (max. 100 caractères)",placeholder:"Ex: Pasteur Jean Dupont"})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(j,{sx:{my:3},children:e.jsx(l,{variant:"h6",children:"Informations système"})})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(x,{fullWidth:!0,label:"ID Département",value:a.idDepartement||"",InputProps:{readOnly:!0},variant:"outlined",disabled:!0})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(x,{fullWidth:!0,label:"ID Utilisateur",value:a.idUtilisateur||"Non défini",InputProps:{readOnly:!0},variant:"outlined",disabled:!0})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(j,{sx:{my:3},children:e.jsx(l,{variant:"h6",children:"État du département"})})}),e.jsx(s,{item:!0,xs:12,md:4,children:e.jsxs(c,{sx:{p:2,bgcolor:"grey.50",borderRadius:1,textAlign:"center"},children:[e.jsx(l,{variant:"subtitle2",color:"text.secondary",children:"Departement"}),e.jsx(l,{variant:"h6",color:t.libelleLongDepartement?"success.main":"error.main",children:t.libelleLongDepartement?"✓ Rempli":"✗ Manquant"})]})}),e.jsx(s,{item:!0,xs:12,md:4,children:e.jsxs(c,{sx:{p:2,bgcolor:"grey.50",borderRadius:1,textAlign:"center"},children:[e.jsx(l,{variant:"subtitle2",color:"text.secondary",children:"Libellé court"}),e.jsx(l,{variant:"h6",color:t.libelleCourtDepartement?"success.main":"error.main",children:t.libelleCourtDepartement?"✓ Rempli":"✗ Manquant"})]})}),e.jsx(s,{item:!0,xs:12,md:4,children:e.jsxs(c,{sx:{p:2,bgcolor:"grey.50",borderRadius:1,textAlign:"center"},children:[e.jsx(l,{variant:"subtitle2",color:"text.secondary",children:"Responsable"}),e.jsx(l,{variant:"h6",color:t.responsableDepartement?"success.main":"warning.main",children:t.responsableDepartement?"✓ Défini":"⚠ Optionnel"})]})}),e.jsxs(s,{item:!0,xs:12,children:[e.jsx(j,{sx:{my:3}}),e.jsxs(c,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(d,{variant:"text",onClick:O,disabled:p,children:"Réinitialiser les modifications"}),e.jsxs(c,{display:"flex",gap:2,children:[e.jsx(d,{variant:"outlined",startIcon:e.jsx(w,{}),onClick:E,disabled:p,children:"Annuler"}),e.jsx(d,{variant:"contained",startIcon:e.jsx(A,{}),onClick:S,disabled:p,children:p?"Enregistrement...":"Enregistrer les modifications"})]})]})]})]})}),e.jsxs(W,{sx:{p:3},children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:"Instructions"}),e.jsx(l,{variant:"body2",color:"text.secondary",paragraph:!0,children:"• Les champs marqués d'un astérisque (*) sont obligatoires."}),e.jsx(l,{variant:"body2",color:"text.secondary",paragraph:!0,children:"• Le libellé court est utilisé comme référence et abréviation."}),e.jsx(l,{variant:"body2",color:"text.secondary",paragraph:!0,children:"• Le slogan est facultatif mais recommandé pour identifier le département."}),e.jsx(l,{variant:"body2",color:"text.secondary",children:"• Assurez-vous que les libellés sont uniques pour éviter les confusions."})]})]})}):e.jsx(y,{children:e.jsx(L,{maxWidth:"lg",children:e.jsxs(c,{textAlign:"center",py:10,children:[e.jsx(l,{variant:"h5",color:"text.secondary",gutterBottom:!0,children:"Département non trouvé"}),e.jsx(d,{variant:"contained",startIcon:e.jsx(R,{}),onClick:k,children:"Retour à la liste"})]})})})}export{oe as DepartementEditView,oe as default};
